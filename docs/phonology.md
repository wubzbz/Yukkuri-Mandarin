# 发音规则

## 1. 基本概念

### 1.1 音节

**在本项目中，“音节”概念特指不含声调的拼音。例如“好”字的拼音是“hǎo”，声调是上声，那么其“音节”就是“hao”。**

目前似乎还没有用于称呼“不带声调的拼音”这一概念的名词。语言学中，最小的语音单位称为“音素”（phoneme），“音节”（syllable）是汉语语音的自然单位，通常一个汉字对应一个音节（儿化音除外）。“声调”（tone）是依附于音节之上、不可或缺的音高属性。拼音（pinyin）是一套用拉丁字母和符号来书面表示一个音节所有组成部分（声母、韵母、声调）的方案。可见，语言学中的音节概念与本项目的“音节”概念并不一致，本项目借用“音节”一词只是一种权宜之计。


### 1.2 声调

声调（Tone）是指音节中具有区别意义作用的音高变化。普通话主要有四个基本声调以及轻声：

- 第一声：阴平（High-Level Tone）

    调值：55。音高自始至终保持在高而平的状态，没有起伏。

- 第二声：阳平（Rising Tone）

    调值：35。音高从中度开始，上升到最高。

- 第三声：上声（Dipping Tone）

    调值：214。音高先从中低降到最低，然后再短促地上升到中高，是一个先降后升的曲折调。但是，在正常语速中，当第三声不在句末时，通常只读其前半部分的“低降”（21），称为“半三声”。

- 第四声：去声（Falling Tone）

    调值：51。音高从最高急剧下降到最低。短促而有力。

- 轻声（Neutral Tone）

    没有固定的音高，其音高由它前面的音节声调来决定。它发音轻短、微弱，原有的声调会消失。常见于一些虚词和词语的后缀（如“桌子”的“子”）。


### 1.3 高低音

在日语中，一个拍（モーラ）是一个短小的、具有计时功能的音段。通常一个假名代表一拍（拗音如きゃ算两个假名但一拍）。日语的高低音（アクセント）是指一个词或短语中，拍与拍之间相对的音高（pitch）变化模式。与汉语声调关注单个音节内部的绝对音高轮廓不同，日语高低音的重点在于多个拍之间的相对高低关系及下降点（核）的位置。

棒读（棒読み）指的是 “不带感情、语调平直地朗读”，形容声音像一根笔直的木棒一样，没有起伏、没有情感波动。它描述的是一种朗读或说话的方式，即忽略语句应有的节奏、停顿、强调和情感，只是机械地、平均地、单调地念出每一个字。


### 1.4 音读

使用假名模拟中文发音的做法历史悠久。音读（音読み，おんよみ）是汉字传入日本时，日本人模仿当时中国（不同朝代、不同地区）的发音，并使其适应日语语音系统后形成的读法。由于汉字是在不同时代从中国不同地区传入的，因此一个字往往有不止一种音读。主要分为：

- 呉音（ごおん）：最早传入，模仿中国南朝时期（吴地）的发音。
- 漢音（かんおん）：在隋唐时期由遣唐使等传入，模仿当时长安地区的发音，是最主要、最常用的音读。
- 唐音（とうおん）：在宋、元、明以后传入，模仿中国近代音。

例字「行」：

- 呉音：ぎょう（修行 - しゅぎょう）
- 漢音：こう（旅行 - りょこう）
- 唐音：あん（行灯 - あんどん）

现代汉语普通话乃至北方官话，南方的吴、粤、闽、客等方言都是中古汉语的直接继承者。它们都保留了中古汉语的一些特点，又随着时间流逝产生了一些创新。由于我国南方多丘陵山地，古代交通不便，闭塞的地理环境下，语言的借用与融合现象较少，保留了更多的古音。而日语音读是中古汉语的模仿者，它不是在自然环境下与汉语同步演化的“直系后代”，而是在中古时期（尤其是唐代）大规模、系统性地照抄了当时长安、洛阳等地的标准音。之后，这套读音在日语内部经历了自身的演变，最终形成了今天的五十音系统。

因此，从这个角度上说，用五十音来拼读“油库里吴语”、“油库里粤语”等似乎在某些方面更容易；但到了另一些方面，又变成“油库里普通话”具有优势了。例如，

- 塞音韵尾：韵尾`-p`，`-t`，`-k`可用无声化的`_プ`，`_ツ`，`_ク`模拟；无韵尾`-ʔ`可用促音模拟。
    - 粤语“国家”：ご_クがー；吴语“北风”：ぼっふぉん。
- 鼻浊音（软腭鼻音）`[ŋ]`：在普通话中已不存，但在南方方言的“疑母”字依然保留。
    - 粤语“牙齿”：か゚あちい；客家话“我”：か゚い。
    - 尽管如此，一些油库里语音生成工具似乎也倾向于将鼻浊音直接念成浊音，所以这点的参考价值似乎不大……
    - 似乎南方方言、日语中这个声母都有脱落的趋势……果然大家都是怎么简单怎么来吗……
- 声调系统：普通话四声用高低音变化来模拟勉强可行；但到了区分声调阴阳的方言中，模拟将会变得困难甚至不可行。
- 韵母系统：中古汉语的声母大约有36个，但是韵母却有约300个！受此影响，南方方言的韵母系统至今依然非常复杂，与《新华字典》的一面就足以写完的普通话韵母相比，用假名拼读南方方言的难度显然更大。

总而言之，从语言学看，本项目还是十分具有趣味性的！


## 2. 什么是“油库里语音”？

油库里（ゆっくり）是一个日语副词或形容词，意思是“慢慢地”、“不慌不忙地”、“悠闲地”。所以，从字面上直接理解，“油库里语音”（ゆっくり語音）就是“慢慢的语音”。

在网络语境，特别是在Niconico动画、Bilibili等视频网站，“ゆっくり語音”或直接简称为“ゆっくり”，指的是一种使用语音合成软件（最初是AquesTalk）生成的、特征为语速缓慢、音调平稳的电子声音，听起来很悠闲、呆萌，几乎没有语调的起伏，但正是这种“棒读”产生了奇特的幽默感。

油库里语音起源于日本的弹幕视频网站Niconico动画。因为其成本低廉且效果独特，早期的视频制作者使用这种语音来为视频配音、讲故事或进行评论。久而久之，这种电子配音就与Niconico、Bilibili的一些亚文化紧密相连了。

使用场景：

- 游戏实况/解说：这是最经典的用法。用“ゆっくり”的声音来解说游戏过程，非常具有喜剧效果。
- 讲故事/读评论：用来朗读小说、都市传说或视频下方的评论。
- 搞笑短片配音：为各种原创或二创的动画短片配音。
- Vtuber：也有一些Vtuber使用类似ゆっくり的简单形象和声音进行直播。


## 3. 什么是“音声记号”？

日语的“重音”是高低重音（ピッチアクセント），一个词的音高模式不同，意思可能完全不同。例如はし（箸）音高模式为高-低，意思是“筷子”。而はし（橋）音高模式为低-高，意思是“桥”。因此，一些语音合成工具开发了所谓“音声记号”（音声記号），通过一系列特定的符号控制合成语音的读音、声调（高低）、节奏、停顿乃至数字和英文的念法。

音声记号一般包括四大类符号：

- 朗读符号（読み記号）：表示基本音节的字符（如`あ`、`か`）。
- 重音符号（アクセント記号）：标注声调核（如`'`）。
- 句切记号（句切記号）：控制短语边界和停顿（如`,`、`、`）。
- 标签符号（タグ記号）：处理数字、英文等特殊读法（如`<NUM VAL=123>`）。

其中我们感兴趣的是一部分重音符号和句切记号，下面将逐个进行介绍。

**重音符号`'`**：英文单引号。代表由高音到低音的变化，例如`あ'め`中的`あ`将是高音而`め`是低音。此记号必须标记于拍与拍之间，例如`きょ'う`是允许的，而`き'ょう`则不行，因为拗音被视为一拍，中间不能被该符号分隔。

**分隔符`/`**：英文斜杠。分隔符属于句切记号的一种，用于分隔“アクセント句”（声调短语/韵律短语）。日语中，一个单词（或单词加上其附属的助词）构成一个自然的声音单位。每个アクセント句的开头两拍音高一般不同，除了1型为高-低外，其他情况为低-高。因此，对于每个アクセント句开头（即句子的开头两拍以及每个斜杠分隔符后的两拍），不使用重音符号标记为1型时，均念作低-高。综上，可以将分隔符的作用简单理解为使其后第1拍为低音，第2拍为高音。例如`/はな`中的`は`为低音，`な`为高音。

**无声化符号`_`**：英文下划线。在下划线后接片假名会使片假名的读音无声化；反之，如果某音被错误地无声化，可以将该音用片假名写出以强制有声化。例如`で_ス`中的`す`将会无声化。只有部分音可以无声化，详情请看本节参考资料。

**逗号**：有两种，分别是英文逗号`,`和中文顿号`、`，属于句切记号。英文逗号触发短暂停顿，顿号触发较长停顿。

**句号`。`**：中文句号。表示句子的结尾。句号与顿号都提供停顿功能，但句号会产生下降语调，以产生完整的结束感。

**问号`?`**：英文问号。用于句子的结尾，使音高上升，产生疑问语气。

### 参考资料

- [AquesTalk音声記号列仕様書](https://www.a-quest.com/archive/manual/siyo_onseikigou.pdf)


## 4. 声调的处理

### 4.1 普通话四声

处理普通话四声的基本思路是使用长音以及高低音变化模拟声调。以音节“ma”为例，使用两拍的长音“まあ”进行模拟。利用音声记号将两拍都标记为高音以模拟阴平（まあ）；令第一拍为低音，第二拍为高音即为阳平（/まあ）；两拍均为低音则为上声（半三声）（'まあ）；令第一拍为高音，第二拍为低音以表示去声（ま'あ）。对于更复杂的音节，将其适当拆分为“声”与“韵”两部分即可按照前述方式处理。

有几种特殊情况值得注意。（1）由于每个アクセント句开头两拍音高一般不一样，当句首字为阴平或上声时，需要进行处理。阴平可以这样表示：`/っまあ`使用分隔符`/`将不发音的促音符号设置为低音，随后的音即为高音。上声可以这样表示：`'ま/あ`。首先使用重音符号`'`将第一拍标记为低音，接着使用分隔符`/`断开アクセント句，这样第二拍自然也是低音了。（2）去声有两种表示方法：`ま'あ`和`ま/あ`。它们的区别在于前者紧随其后的一拍将是低音，适合阳平、上声字；而后者反之，适合阴平、去声字。可见，高低音系统使得句子中某个字的音声记号标记方式会受到其前、后字读音的影响。这也是我们使用前一字、当前字、后一字声调组成的三位数来构造`tone`参数的原因。

### 4.2 普通话轻声

> [!NOTE]
> 本节内容有可能在后续更新中发生变化。

**目前**轻声念法与阴平一致，并未做出区分。

轻声声调用`5`表示。轻声的音节持续时间明显比正常声调的音节要短。这个特点或许可以通过减少一拍甚至使用促音模拟。轻声的音高取决于它前面那个音节的声调，它自己没有固定的调值。由于`tone`参数包含前一字的声调信息，因此调值变化的模拟很容易实现。轻声的音节发音力度较弱，不那么突出。

轻声的音节发音力度较弱，且有时会导致韵母中的元音变得模糊甚至脱落。这个特点因词而异，需要在后续测试过程中调整打磨。您可以使用以下命令升级油库里普通话，以获得最新的拼音数据库：

```bash
pip install --upgrade yukkuri-mandarin
```

对于任何您不满意的发音，可以使用[拼音数据库管理](https://github.com/wubzbz/Yukkuri-Mandarin/blob/main/docs/database-mngr.md)模块进行修改。

### 4.3 连续上声变调

> [!NOTE]
> 本节内容有可能在后续更新中发生变化。

当两个上声连读时，第一个上声要变成阳平。例如“你好”两字均为上声，因此口语中会把第一个字念成阳平，变成“尼好”。连续上声变调通常有以下几种情况：

1. 两字组。前一个上声字变调为阳平，后一个字保持原调。如“你好”。
2. 三字组（2+1）。前两个字（作为一个整体）先发生变调，然后再与第三个字发生变调。如“展览馆”。
3. 三字组（1+2）。后两个字形成的“双字组”发生变调。如“小老虎”。

很遗憾，目前油库里普通话的连续上声变调处理功能还不完善——只是机械地切割两字组和三字组，而不能按照分词和意群处理更复杂的情况。因此，当出现连续上声变调错误时，请转为使用`pinyin_convert()`函数直接指定变调后的音调。见下例：

```python
from yukkurimandarin import text_convert

print(text_convert("我想你也有这种想法。"))
# 会得到错误的声调：wó xiǎng ní yé yǒu
```

```python
from yukkurimandarin import pinyin_convert

# 直接指定变调后的声调
print(pinyin_convert("wo2 xiang3 ni3 ye2 you3 zhe4 zhong3 xiang2 fa3 ."))
```

## 5. 单韵母和复韵母的处理

韵母a、o分别用あ、お模拟，虽然不是完全一样，但还算比较相似。普通话的a舌位稍靠后（央低[ᴀ]），日语的あ是前低元音[a]，但听起来差别较小。普通话的o唇更圆更紧，而お唇形更松，且舌位稍靠前一点。

韵母e没有类似的发音，姑且用元音え代替：在普通话中似乎只有“耶”（ye）去除y介音的部分类似，其他音节发音相似度都较低。“儿子”（ér zi）只能念成“えー　ずい”。（o_o ....

韵母i（不含y介音）和い很相似，唯有音节“yi”发不出y介音。

韵母u用う模拟。普通话的u唇非常圆，强烈突出；日语的う唇形非常松，几乎不圆，舌位也更靠前一些。尽管差异明显，但已是比较接近的方案。

韵母ü的模拟是一个难题，处理方法因词而异。音节“yu”或可用“ゆう”代表，音节“lü”则用“ぃう”勉强模拟。到了音节“nü”，为了和“nu”、“niu”区分，只好用“ぬい”模拟发音。~~（油库里天津话）~~

前响复韵母发音时，口形、舌位会有一个滑动的过程，这点比较容易模拟。比如“ai”可用“あい”。中响和后响复韵母处理方法类似，但使用拗音加长音的结构会使发音连续性更好。比如音节“jia”用“じゃあ”比“じあ”听起来整体性更强。


## 6. 鼻韵母的处理

暂时没有很好的区分方法，只能笼统地以拨音“ん”代表。


## 7. 卷舌音r的处理

无解。立本银读不出卷舌音，所以都用ら行代替。


## 8. 儿化音的处理

参考上一小节，忽略所有儿化音。原本发儿化音的“儿”字一律念作“er”，即“えー”。


## 9. 平翘舌音的处理

平舌音z、c、s以ず、つ、す表示。翘舌音zh、ch大多来自中古汉语“知”、“彻”、“澄”三个声母，翘舌音sh的来源比较复杂。演化至今除普通话外还有几种方案可供参考（非严格对应）：

| 普通话 | zh | ch | sh |
| ----- | -- | -- | -- |
| 闽方言 | d | t | z |
| 舌面化 | j | q | x |
| 平舌化 | z | c | s |

其中闽方言与上古音相关，与普通话差异太大，故不考虑。权衡之下，选择了舌尖前音的方案，即念作对应的平舌音。如果您对此不满意，可以使用[拼音数据库管理](https://github.com/wubzbz/Yukkuri-Mandarin/blob/main/docs/database-mngr.md)模块进行修改。


## 10. di和ti的处理

含“di-”和“ti-”的拼音的处理方式参考其他外来语的读法，分别为“でぃ”和“てぃ”。